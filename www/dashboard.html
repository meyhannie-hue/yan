<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Techy Me</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f0f0;
    }
    .app-container {
      width: 100%;
      max-width: 420px;
      height: 100vh;
      margin: auto;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      background: linear-gradient(to bottom right, #7be0d6 20%, #675bcb 80%);
    }
    header {
      position: relative;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 20px;
    }
    .points-display {
      position: absolute;
      left: 20px;
      font-size: 1rem;
      font-weight: bold;
      color: #fff;
    }
    .title {
      font-size: 1.6rem;
      font-weight: bold;
      color: #fff;
    }
    .logout-btn {
      position: absolute;
      right: 20px;
      font-size: 1.4rem;
      cursor: pointer;
      color: white;
      transition: transform 0.2s ease;
    }
    .logout-btn:hover {
      transform: scale(1.2);
    }
    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      flex-grow: 1;
      gap: 20px;
      padding: 80px 20px 120px;
    }
    .feature {
  width: 90%;
  max-width: 320px;
  background: linear-gradient(135deg, #ffffff, #f2f5ff);
  border-radius: 20px;
  padding: 20px;
  font-size: 20px;
  font-weight: 600;
  text-align: center;
  color: #333;
  position: relative;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
  transition: transform 0.2s ease, box-shadow 0.3s ease;
  cursor: pointer; /* ‚úÖ Always pointer */
}

.feature:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
}

.feature.locked {
  opacity: 0.6;
  filter: grayscale(100%);
  /* Removed pointer-events: none; so cursor still shows */
}
    .feature .description {
      font-size: 14px;
      font-weight: 400;
      color: #666;
      margin-top: 10px;
    }
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100px;
      background-color: #ffffff;
      border-top: 1px solid #ccc;
      display: flex;
      justify-content: space-around;
      align-items: center;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      z-index: 10;
    }
    .icon {
      font-size: 30px;
      color: #4a90e2;
      cursor: pointer;
    }
    .icon.active {
      background: #4e5d78;
      padding: 8px 12px;
      border-radius: 50%;
      color: white;
    }
    @media (orientation: landscape) {
      .app-container {
        max-width: 680px;
      }
      main {
        flex-direction: row;
        padding: 50px;
        flex-wrap: wrap;
      }
      .feature {
        flex: 1 1 calc(33% - 10px);
        margin: 5px;
      }
    }
    @media (max-width: 480px) {
      .points-display {
        font-size: 20px;
      }
      .feature div {
        font-size: 30px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <div id="points" class="points-display">üí∞ 0</div>
      <div class="title">TECHY ME</div>
      <div class="logout-btn" onclick="logout()" title="Logout">‚çà</div>
    </header>

    <main>
      <div class="feature" onclick="goToNetworking()" id="networkingFeature">
        ‚öôÔ∏è Networking
        <div class="description">Wiring Scheme</div>
      </div>
      <div class="feature" onclick="handleProgrammingClick()" id="programmingFeature">
        üíª Programming
        <div class="description">HTML/CSS, PHP, & JS</div>
      </div>
      <div class="feature" onclick="handleSystemUnitClick()" id="systemUnitFeature">
        üß© System Unit
        <div class="description">Assemble/Disassemble</div>
      </div>
    </main>

    <footer>
      <div class="icon" onclick="playClick(); gotoAbout()">üßæ</div>
      <div class="icon" onclick="playClick(); gotoLeaderboard()">üìä</div>
      <div class="icon active" onclick="playClick(); gotoDashboard()">üëë</div>
      <div class="icon" onclick="playClick(); gotoSetting()">‚öôÔ∏è</div>
    </footer>
  </div>

  <audio id="clickSound" src="sounds/Button_Click_-_Sound_Effect(256k).mp3" preload="auto"></audio>

  <script>
    const playerName = sessionStorage.getItem("playerName");
    const api = "https://yani-gk4a.onrender.com/api/"; // change if deployed elsewhere

    if (!playerName) {
      window.location.href = "index.html";
    }

    function playClick() {
      const sound = document.getElementById("clickSound");
      sound.currentTime = 0;
      sound.play().catch(() => {});
    }

    async function loadDashboard() {
      try {
        const res = await fetch(`${api}/player/${encodeURIComponent(playerName)}`);
        if (!res.ok) throw new Error("Player not found.");

        const player = await res.json();
        const points = player.points || 0;
        document.getElementById("points").textContent = `üí∞ ${points}`;
        window.playerPoints = points;

        const boughtProgramming = localStorage.getItem(`${playerName}_boughtProgramming`) === "true";
        const boughtSystemUnit = localStorage.getItem(`${playerName}_boughtSystemUnit`) === "true";

        if (!boughtProgramming) {
          document.getElementById("programmingFeature").classList.add("locked");
        } else {
          document.getElementById("programmingFeature").classList.remove("locked");
        }

        if (!boughtSystemUnit) {
          document.getElementById("systemUnitFeature").classList.add("locked");
        } else {
          document.getElementById("systemUnitFeature").classList.remove("locked");
        }

      } catch (err) {
        alert("‚ùå Failed to load dashboard. Please try again.");
        console.error(err);
        sessionStorage.removeItem("playerName");
        window.location.href = "index.html";
      }
    }

    function goToNetworking() {
      playClick();
      window.location.href = "levels/networkinglevels.html";
    }

    function handleProgrammingClick() {
      playClick();
      const bought = localStorage.getItem(`${playerName}_boughtProgramming`) === "true";
      if (!bought) {
        if (window.playerPoints >= 4560) {
          if (confirm("üíª Buy Programming for 4560 points?")) {
            window.playerPoints -= 4560;
            localStorage.setItem(`${playerName}_boughtProgramming`, "true");
            document.getElementById("points").textContent = `üí∞ ${window.playerPoints}`;
            document.getElementById("programmingFeature").classList.remove("locked");
            alert("üéâ Programming purchased!");
          }
        } else {
          alert("‚ùå Not enough points to buy Programming.");
        }
        return;
      }
      window.location.href = "levels/programminglevel.html";
    }

    function handleSystemUnitClick() {
      playClick();
      const bought = localStorage.getItem(`${playerName}_boughtSystemUnit`) === "true";
      if (!bought) {
        if (window.playerPoints >= 9480) {
          if (confirm("üß© Buy System Unit for 9480 points?")) {
            window.playerPoints -= 9480;
            localStorage.setItem(`${playerName}_boughtSystemUnit`, "true");
            document.getElementById("points").textContent = `üí∞ ${window.playerPoints}`;
            document.getElementById("systemUnitFeature").classList.remove("locked");
            alert("üéâ System Unit purchased!");
          }
        } else {
          alert("‚ùå Not enough points to buy System Unit.");
        }
        return;
      }
      window.location.href = "levels/systemunitlevel.html";
    }

    function logout() {
      sessionStorage.removeItem("playerName");
      window.location.href = "index.html";
    }

    function gotoAbout() {
      window.location.href = "about.html";
    }

    function gotoLeaderboard() {
      window.location.href = "leaderboard.html";
    }

    function gotoDashboard() {
      window.location.href = "dashboard.html";
    }

    function gotoSetting() {
      alert("‚öôÔ∏è Settings coming soon!");
    }

    document.addEventListener("DOMContentLoaded", loadDashboard);
  </script>
</body>
</html>
